# This workflow will build a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

name: Account Client - Deploy

on: 
  workflow_dispatch:

# Environment variables used in the workflow
env:
  # Dynamic environment variables
  PROJECT_NAME: AccountClient

  # Static environment variables
  BUILD_TIMEOUT: 15
  CONFIGURATION: Release
  NUGET_SOURCE: DarkFactorAS
  
defaults:
  run:
    working-directory: ./${{ env.PROJECT_NAME }}

jobs:
  build:

    # Timeout for the job
    timeout-minutes: ${{ env.BUILD_TIMEOUT }}

    runs-on: ubuntu-latest

    # Build steps
    steps:

    # Check out code from the repository
    - name: Checkout repository
      uses: actions/checkout@v4    

    # Build Account Client
    - name: Add GitHub nuget repository
      run: dotnet nuget update source ${{ env.NUGET_SOURCE }} --username ${{ secrets.NUGET_USERNAME }}  --password ${{ secrets.NUGET_TOKEN }} --store-password-in-clear-text

    - name: AccountClient - Restore dependencies
      run: dotnet restore ${{ env.PROJECT_NAME }}.csproj

    - name: AccountClient - Build
      run: dotnet build ${{ env.PROJECT_NAME }}.csproj --no-restore --configuration ${{ env.CONFIGURATION }}

    # Deploy Account Client
    - name: Pack Nuget
      run: dotnet pack ${{ env.PROJECT_NAME }}.csproj --configuration ${{ env.CONFIGURATION }} -p:NuspecFile=./${{ env.PROJECT_NAME }}.nuspec

    - name: Deploy
      run: 
        dotnet nuget push "bin/${{ env.CONFIGURATION }}/*.nupkg"  --api-key ${{ secrets.NUGET_TOKEN }} --source ${{ env.NUGET_SOURCE }} --skip-duplicate
