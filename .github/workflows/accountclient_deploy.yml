#
# Build Nuget deploy file
# Change the variables in this section to match your project
#

name: Account Client - Deploy
env:
  PROJECT_NAME: AccountClient
  CONFIGURATION: Debug
defaults:
  run:
    working-directory: ./AccountClient

#
# Everything below this is template code
#

on: 
  workflow_dispatch:

jobs:
  build:

    # Timeout for the job
    timeout-minutes: 15

    runs-on: ubuntu-latest

    # Build steps
    steps:

    # Check out code from the repository
    - name: Checkout repository
      uses: actions/checkout@v4    

    # Build Account Client
    - name: Add GitHub nuget repository
      run: dotnet nuget update source DarkFactorAS --username ${{ secrets.NUGET_USERNAME }}  --password ${{ secrets.NUGET_TOKEN }} --store-password-in-clear-text

    - name: ${{ env.PROJECT_NAME }}  - Restore dependencies
      run: dotnet restore ${{ env.PROJECT_NAME }}.csproj

    - name: ${{ env.PROJECT_NAME }}  - Build
      run: dotnet build ${{ env.PROJECT_NAME }}.csproj --no-restore --configuration ${{ env.CONFIGURATION }}

    # Deploy Account Client
    - name: ${{ env.PROJECT_NAME }} - Pack Nuget
      run: dotnet pack ${{ env.PROJECT_NAME }}.csproj --configuration ${{ env.CONFIGURATION }} -p:NuspecFile=./${{ env.PROJECT_NAME }}.nuspec

    - name: ${{ env.PROJECT_NAME }} - Deploy
      run: 
        dotnet nuget push "bin/${{ env.CONFIGURATION }}/*.nupkg"  --api-key ${{ secrets.NUGET_TOKEN }} --source DarkFactorAS --skip-duplicate
